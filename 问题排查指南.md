# 问题排查指南

## 问题1：CSS样式不能正常显示

### 可能原因和解决方法：

1. **Filter拦截了静态资源**
   - ✅ 已修复：Filter现在会正确识别静态资源（.css, .js文件）并直接放行
   - 检查方法：访问 `http://localhost:8080/webwork2/css/style.css` 应该能看到CSS内容

2. **路径问题**
   - 确保CSS文件在 `src/main/webapp/css/style.css`
   - 确保JS文件在 `src/main/webapp/js/main.js`
   - JSP中使用 `${pageContext.request.contextPath}/css/style.css` 引用

3. **浏览器缓存**
   - 按 `Ctrl+F5` 强制刷新页面
   - 或清除浏览器缓存

4. **Tomcat未正确部署**
   - 检查 `webapps/webwork2/css/` 目录是否存在
   - 重新打包部署：`mvn clean package`

## 问题2：登录一直提示账号密码错误

### 排查步骤：

#### 步骤1：检查数据库连接

访问测试页面：`http://localhost:8080/webwork2/testdb`

这个页面会显示：
- 数据库连接状态
- 用户表中的所有用户信息
- 详细的错误信息

#### 步骤2：检查数据库配置

编辑 `src/main/java/com/blog/dao/DBUtil.java`，确认以下配置：

```java
private static final String URL = "jdbc:mysql://localhost:3306/blog2_db?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai";
private static final String USERNAME = "root";  // 修改为你的MySQL用户名
private static final String PASSWORD = "123456";  // 修改为你的MySQL密码
```

#### 步骤3：检查数据库是否已初始化

执行以下SQL检查：

```sql
USE blog2_db;
SELECT * FROM users;
```

应该能看到3条记录：
- admin / admin / admin
- user1 / 123456 / guest
- user2 / 123456 / guest

如果没有数据，执行 `database/init.sql` 脚本。

#### 步骤4：查看Tomcat日志

查看 `Tomcat安装目录/logs/catalina.out` 文件，查找：
- "数据库连接成功" 或 "数据库连接失败"
- "尝试登录" 相关信息
- SQL异常信息

#### 步骤5：常见问题

**问题A：数据库连接失败**
- 检查MySQL服务是否启动
- 检查端口是否为3306
- 检查用户名密码是否正确
- 检查数据库 `blog2_db` 是否存在

**问题B：用户不存在**
- 确认已执行 `database/init.sql`
- 检查用户表中的数据

**问题C：密码不匹配**
- 确认密码是明文存储（未加密）
- 测试账号：admin/admin 或 user1/123456

## 问题3：其他可能的问题

### 404错误
- 检查访问路径是否正确
- 检查WAR文件是否正确部署
- 检查 `webapps/webwork2` 目录结构

### 500错误
- 查看Tomcat日志文件
- 检查数据库连接
- 检查JSP语法错误

### 中文乱码
- 确认数据库使用 `utf8mb4` 字符集
- 确认JSP页面设置了 `pageEncoding="UTF-8"`
- 确认请求和响应都设置了UTF-8编码

## 快速诊断命令

### 1. 检查数据库连接
```bash
mysql -u root -p -e "USE blog2_db; SELECT * FROM users;"
```

### 2. 检查Tomcat日志
```bash
# Windows
type C:\apache-tomcat-9.0.63\logs\catalina.out | findstr "数据库\|登录\|错误"

# Linux/Mac
tail -f /path/to/tomcat/logs/catalina.out | grep -i "数据库\|登录\|错误"
```

### 3. 检查文件是否存在
```bash
# Windows
dir C:\apache-tomcat-9.0.63\webapps\webwork2\css\style.css
dir C:\apache-tomcat-9.0.63\webapps\webwork2\js\main.js

# Linux/Mac
ls -l /path/to/tomcat/webapps/webwork2/css/style.css
ls -l /path/to/tomcat/webapps/webwork2/js/main.js
```

## 修复后的验证

修复后，请验证以下功能：

1. ✅ 访问登录页面，CSS样式正常显示
2. ✅ 使用 admin/admin 可以成功登录
3. ✅ 登录后跳转到正确的页面（admin跳转到管理后台，guest跳转到文章列表）
4. ✅ 文章列表页面样式正常
5. ✅ 可以查看文章详情
6. ✅ 可以发表评论（需要登录）

## 如果问题仍然存在

1. 查看Tomcat控制台输出的详细日志
2. 检查浏览器开发者工具（F12）：
   - Network标签：查看CSS/JS文件是否成功加载（状态码200）
   - Console标签：查看JavaScript错误
3. 访问测试页面 `/testdb` 查看数据库连接状态
4. 检查 `DBUtil.java` 中的数据库配置是否正确

