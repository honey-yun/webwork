# 个人博客系统部署教程

## 一、环境要求

- JDK 1.8 或更高版本
- Maven 3.6+
- MySQL 5.7+ 或 MySQL 8.0+
- Tomcat 9.0.63

## 二、数据库配置

### 1. 创建数据库

打开MySQL命令行或客户端，执行以下SQL脚本：

```bash
mysql -u root -p < database/init.sql
```

或者手动执行 `database/init.sql` 文件中的SQL语句。

### 2. 修改数据库连接配置

编辑 `src/main/java/com/blog/dao/DBUtil.java` 文件，修改以下配置：

```java
private static final String URL = "jdbc:mysql://localhost:3306/blog2_db?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai";
private static final String USERNAME = "root";  // 修改为你的MySQL用户名
private static final String PASSWORD = "root";  // 修改为你的MySQL密码
```

## 三、Maven 打包

在项目根目录下执行：

```bash
mvn clean package
```

打包成功后，会在 `target` 目录下生成 `webwork2-1.0-SNAPSHOT.war` 文件。

## 四、部署到 Tomcat

### 方法一：直接拷贝 WAR 文件

1. 将生成的 WAR 文件复制到 Tomcat 的 `webapps` 目录：
   ```bash
   copy target\webwork2-1.0-SNAPSHOT.war C:\apache-tomcat-9.0.63\webapps\webwork2.war
   ```
   （Linux/Mac 使用 `cp` 命令）

2. 启动 Tomcat：
   - Windows: 运行 `bin\startup.bat`
   - Linux/Mac: 运行 `bin/startup.sh`

3. Tomcat 会自动解压 WAR 文件并部署应用。

### 方法二：使用 Tomcat Manager（推荐）

1. 配置 Tomcat Manager 用户（编辑 `conf/tomcat-users.xml`）：
   ```xml
   <role rolename="manager-gui"/>
   <user username="admin" password="admin" roles="manager-gui"/>
   ```

2. 访问 `http://localhost:8080/manager/html`

3. 在 "WAR file to deploy" 部分上传 WAR 文件进行部署。

## 五、启动 Tomcat

### Windows

```bash
cd C:\apache-tomcat-9.0.63\bin
startup.bat
```

### Linux/Mac

```bash
cd /path/to/apache-tomcat-9.0.63/bin
./startup.sh
```

### 验证启动

打开浏览器访问：`http://localhost:8080/webwork2`

如果看到文章列表页面，说明部署成功！

## 六、测试账号

系统已预置以下测试账号：

| 用户名 | 密码 | 角色 |
|--------|------|------|
| admin  | admin | 管理员 |
| user1  | 123456 | 普通用户 |
| user2  | 123456 | 普通用户 |

## 七、常见错误及解决方法

### 1. 404 错误 - 页面未找到

**原因：**
- 访问路径错误
- WAR 文件未正确部署
- 应用上下文路径不正确

**解决方法：**
- 检查访问URL是否正确：`http://localhost:8080/webwork2/post_list`
- 检查 Tomcat `webapps` 目录下是否有 `webwork2` 文件夹
- 查看 Tomcat 日志：`logs/catalina.out`

### 2. 数据库连接失败

**错误信息：**
```
java.sql.SQLException: Access denied for user 'root'@'localhost'
或
Communications link failure
```

**解决方法：**
- 检查 MySQL 服务是否启动
- 确认 `DBUtil.java` 中的数据库用户名和密码是否正确
- 确认数据库 `blog2_db` 是否已创建
- 检查 MySQL 是否允许远程连接（如果使用远程数据库）

### 3. 500 错误 - 服务器内部错误

**原因：**
- 数据库表未创建
- SQL 语句执行错误
- 代码编译错误

**解决方法：**
- 检查数据库表是否已创建：`SHOW TABLES;`
- 查看 Tomcat 日志文件：`logs/catalina.out` 或 `logs/localhost.log`
- 确认已执行 `database/init.sql` 初始化脚本
- 检查 JSP 页面中的 JSTL 标签是否正确引入

### 4. 中文乱码问题

**解决方法：**
- 确认数据库使用 `utf8mb4` 字符集
- 检查 JSP 页面是否设置了 `pageEncoding="UTF-8"`
- 确认 `web.xml` 中配置了字符编码过滤器

### 5. 过滤器不生效

**原因：**
- Filter 类未正确配置
- URL 模式匹配错误

**解决方法：**
- 检查 Filter 类上的 `@WebFilter` 注解
- 确认 `urlPatterns` 配置正确
- 查看 Tomcat 启动日志确认 Filter 已加载

### 6. 无法访问管理员页面

**原因：**
- 未登录或登录状态失效
- 用户角色不是 `admin`

**解决方法：**
- 使用管理员账号登录：`admin/admin`
- 检查 Session 中 `role` 属性是否为 `admin`
- 清除浏览器 Cookie 后重新登录

## 八、项目结构说明

```
webwork2/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/blog/
│   │   │       ├── model/      # JavaBean实体类
│   │   │       ├── dao/         # 数据访问层
│   │   │       ├── servlet/     # 控制层Servlet
│   │   │       └── filter/      # 过滤器
│   │   └── webapp/
│   │       ├── index.jsp
│   │       └── WEB-INF/
│   │           ├── views/       # JSP视图页面
│   │           └── web.xml      # Web应用配置
│   └── test/
├── database/
│   └── init.sql                 # 数据库初始化脚本
├── pom.xml                      # Maven配置文件
└── 部署教程.md                   # 本文件
```

## 九、功能说明

### 普通用户功能
- 查看文章列表
- 查看文章详情
- 发表评论

### 管理员功能
- 所有普通用户功能
- 发布文章
- 访问管理后台

### 权限控制
- `AuthFilter`: 未登录用户只能访问登录页和文章列表
- `AdminFilter`: 只有管理员可以访问管理后台和发布文章页面

## 十、停止 Tomcat

### Windows

```bash
cd C:\apache-tomcat-9.0.63\bin
shutdown.bat
```

### Linux/Mac

```bash
cd /path/to/apache-tomcat-9.0.63/bin
./shutdown.sh
```

## 十一、重新部署

如果需要重新部署：

1. 停止 Tomcat
2. 删除 `webapps/webwork2` 目录和 `webapps/webwork2.war` 文件
3. 重新执行 `mvn clean package`
4. 将新的 WAR 文件复制到 `webapps` 目录
5. 启动 Tomcat

---

**祝部署顺利！如有问题，请查看 Tomcat 日志文件进行排查。**

